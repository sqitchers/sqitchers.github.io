<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Sqitch: sqitchtutorial-clickhouse Documentation</title>
	<meta name="description" content="A tutorial introduction to Sqitch change management on ClickHouse" />
	<link rel="stylesheet" href="/css/screen.css" />
	<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/img/icon-32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/img/icon-16.png" />
	<link rel="manifest" href="/site.webmanifest" />
	<link rel="mask-icon" href="/img/sqitch-icon-black.svg" color="#22538e" />
	<meta name="msapplication-TileColor" content="#22538e" />
	<meta name="theme-color" content="#fcffff" />
	<meta name="generator" content="Hugo 0.151.0">
</head>
<body>
	<header id=masthead>
		<hgroup id="top">
			<h1><a href="/"><img src="/img/sqitch-logo-100.png" srcset="/img/sqitch-logo.svg" alt="Sqitch" title="Sqitch" /></a></h1>
		</hgroup>
		<nav id="bar">
			<menu>
				<li><a href="/about" title="About Sqitch" class="about">About</a></li>
				<li><a href="/docs/" title="Sqitch Manual, tutorials, and presentations" class="docs">Docs</a></li>
				<li><a href="/community/" title="Join the Sqitch community" class="community">Community</a></li>
				<li><a href="/download/" title="Download and install Sqitch" class="download">Download</a></li>
				<li><a href="https://github.com/sqitchers/sqitch" title="Sqitch on GitHub" class="github">GitHub</a></li>
			</menu>
		</nav>
	</header>

	<header id="title">
		<h1>sqitchtutorial-clickhouse</h1>
	</header>
	<main id="docs" class="page">
		
<aside class="toc" title="Table of Contents">
	<details>
		<summary><h4>Contents</h4></summary>
		<nav>
			<h3>Contents</h3>
			<ul><li><a href='#name'>Name</a></li>
				<li><a href='#synopsis'>Synopsis</a></li>
				<li><a href='#description'>Description</a><ul>
				<li><a href='#connection-configuration'>Connection Configuration</a><ul>
				<li><a href='#ports'>Ports</a></li></ul>
				</li></ul>
				</li><li><a href='#starting-a-new-project'>Starting a New Project</a></li>
				<li><a href='#our-first-change'>Our First Change</a><ul>
				<li><a href='#trust-but-verify'>Trust, But Verify</a></li>
				<li><a href='#status-revert-log-repeat'>Status, Revert, Log, Repeat</a></li></ul>
				</li><li><a href='#on-target'>On Target</a></li>
				<li><a href='#deploy-with-dependency'>Deploy with Dependency</a></li>
				<li><a href='#view-to-a-thrill'>View to a Thrill</a></li>
				<li><a href='#ship-it'>Ship It!</a></li>
				<li><a href='#making-a-hash-of-things'>Making a Hash of Things</a><ul>
				<li><a href='#emergency'>Emergency</a></li>
				<li><a href='#merges-mastered'>Merges Mastered</a></li></ul>
				</li><li><a href='#in-place-changes'>In Place Changes</a></li>
				<li><a href='#more-to-come'>More to Come</a></li>
				<li><a href='#author'>Author</a></li>
				<li><a href='#license'>License</a></li>
			</ul>
		</nav>
	</details>
	<script src="/js/toc.js"></script>
</aside>
		<h2 id="name">Name</h2>
<p>sqitchtutorial-clickhouse - A tutorial introduction to Sqitch change management on ClickHouse</p>
<h2 id="synopsis">Synopsis</h2>
<pre tabindex="0"><code>sqitch *
</code></pre><h2 id="description">Description</h2>
<p>This tutorial explains how to create a sqitch-enabled ClickHouse project, use a
VCS for deployment planning, and work with other developers to make sure
changes remain in sync and in the proper order.</p>
<p>We&rsquo;ll start by creating a new project from scratch, a fictional antisocial
networking site called Flipr. All examples use <a href="https://git-scm.com/">Git</a> as
the VCS and <a href="https://clickhouse.com/clickhouse">ClickHouse</a> as the storage
engine, but for the most part you can substitute other VCSes and database
engines in the examples as appropriate.</p>
<p>If you&rsquo;d like to manage a database with a different database engine, see one
of the following other tutorials:</p>
<ul>
<li><a href="/docs/manual/sqitchtutorial">PostgreSQL, Yugabyte, and CockroachDB Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-sqlite">SQLite Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-oracle">Oracle Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-mysql">MySQL and MariaDB Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-firebird">Firebird Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-vertica">Vertica Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-exasol">Exasol Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-snowflake">Snowflake Tutorial</a></li>
<li><a href="/docs/manual/sqitchtutorial-clickhouse">ClickHouse Tutorial</a></li>
</ul>
<h3 id="connection-configuration">Connection Configuration</h3>
<p>Sqitch requires ClickHouse v25.8 or higher for its support for lightweight
updates and deletes. If you&rsquo;ve upgraded an instance from an earlier version,
be sure to <code>SET compatibility = '25.8'</code> or higher.</p>
<p>Sqitch requires ODBC to connect to the ClickHouse database. As such, you&rsquo;ll
need to make sure that the
<a href="https://github.com/ClickHouse/clickhouse-odbc">ClickHouse ODBC driver</a>
is installed and properly configured. At its simplest, on Unix-like systems,
name the driver &ldquo;ClickHouse&rdquo; by adding this entry to <code>odbcinst.ini</code> (usually
found in <code>/etc</code>, <code>/usr/etc</code>, or <code>/usr/local/etc</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[ClickHouse]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">Unicode ODBC Driver for ClickHouse</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Driver</span>      <span style="color:#f92672">=</span> <span style="color:#e6db74">/opt/clickhouse/lib/libclickhouseodbcw.so</span>
</span></span></code></pre></div><p>Note the use of the Unicode rather than the ANSI driver. Also, you might need
to adjust the path depending on the version of the ODBC driver, and where you
installed it. Consult the documentation for your ODBC driver manager (e.g.,
<a href="https://www.unixodbc.org">UnixODBC</a> or <a href="https://www.iodbc.org">iODBC</a>) for
details.</p>
<p>With this configured, Sqitch target URIs can specify the driver name like so:</p>
<pre tabindex="0"><code>db:clickhouse://user:pass@host:port/dbname?Driver=ClickHouse
</code></pre><h4 id="ports">Ports</h4>
<p>In addition to the ODBC connection Sqitch uses to maintain its registry
tables, it depends on the
<code>ClickHouse Client|https://clickhouse.com/docs/interfaces/cli</code> to run
change scripts. As such, Sqitch requires on both the HTTP and Native
<a href="https://clickhouse.com/docs/guides/sre/network-ports">ports</a> to connect.\
The port provided as part of a URI will determines the HTTP port used
by ODBC. Therefore, if your ClickHouse server uses a non-standard Native
port (other than <code>9004</code> or <code>9440</code> for encrypted connections), you&rsquo;ll
need to specify the native port via the <code>NativePort</code> query parameter:</p>
<pre tabindex="0"><code>db:clickhouse://user:pass@host:port/dbname?Driver=ClickHouse?NativePort=9999
</code></pre><h2 id="starting-a-new-project">Starting a New Project</h2>
<p>Usually the first thing to do when starting a new project is to create a
source code repository. So let&rsquo;s do that with Git:</p>
<pre tabindex="0"><code>&gt; mkdir flipr
&gt; cd flipr
&gt; git init .
Initialized empty Git repository in /flipr/.git/
&gt; touch README.md
&gt; git add .
&gt; git commit -am &#39;Initialize project, add README.&#39;
[main (root-commit) 046b8f5] Initialize project, add README.
 1 file changed, 38 insertions(+)
 create mode 100644 README.md
</code></pre><p>If you&rsquo;re a Git user and want to follow along the history, the repository
used in these examples is
<a href="https://github.com/sqitchers/sqitch-clickhouse-intro">on GitHub</a>.</p>
<p>Now that we have a repository, let&rsquo;s get started with Sqitch. Every Sqitch
project must have a name associated with it, and, optionally, a unique URI. We
recommend including the URI, as it increases the uniqueness of object
identifiers internally, and will prevent the deployment of a different project
with the same name. So let&rsquo;s specify one when we initialize Sqitch:</p>
<pre tabindex="0"><code>&gt; sqitch init flipr --uri https://github.com/sqitchers/sqitch-clickhouse-intro/ --engine clickhouse
Created sqitch.conf
Created sqitch.plan
Created deploy/
Created revert/
Created verify/
</code></pre><p>Let&rsquo;s have a look at <code>sqitch.conf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">&gt; cat sqitch.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[core]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">engine</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # plan_file = sqitch.plan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # top_dir = .</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [engine &#34;clickhouse&#34;]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># target = db:clickhouse:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># registry = sqitch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># client = clickhouse-client</span>
</span></span></code></pre></div><p>Good, it picked up on the fact that we&rsquo;re creating changes for the ClickHouse
engine, thanks to the <code>--engine clickhouse</code> option, and saved it to the
file. Furthermore, it wrote a commented-out <code>[engine &quot;clickhouse&quot;]</code> section
with ClickHouse engine-specific settings commented out and ready to be edited
as appropriate.</p>
<p>By default, Sqitch will read <code>sqitch.conf</code> in the current directory for
settings. But it will also read <code>~/.sqitch/sqitch.conf</code> for user-specific
settings. Since ClickHouse&rsquo;s <code>clickhouse</code> client is not in the path on my
system, let&rsquo;s go ahead an tell it where to find the client on our computer
(don&rsquo;t bother if you&rsquo;re using the
<a href="https://hub.docker.com/r/sqitch/sqitch/">Docker image</a> because it uses the
client inside the container, not on your host machine):</p>
<pre tabindex="0"><code>&gt; sqitch config --user engine.clickhouse.client /opt/bin/clickhouse
</code></pre><p>And let&rsquo;s also tell it who we are, since this data will be used in all
of our projects:</p>
<pre tabindex="0"><code>&gt; sqitch config --user user.name &#39;Marge N. O’Vera&#39;
&gt; sqitch config --user user.email &#39;marge@example.com&#39;
</code></pre><p>Have a look at <code>~/.sqitch/sqitch.conf</code> and you&rsquo;ll see this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">&gt; cat ~/.sqitch/sqitch.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[engine &#34;clickhouse&#34;]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/opt/bin/clickhouse</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[user]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">Marge N. O’Vera
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        email = marge@example.com</span>
</span></span></code></pre></div><p>Which means that Sqitch should be able to find <code>clickhouse</code> for any project,
and that it will always properly identify us when planning and committing
changes.</p>
<p>Back to the repository. Have a look at the plan file, <code>sqitch.plan</code>:</p>
<pre tabindex="0"><code>&gt; cat sqitch.plan
%syntax-version=1.0.0
%project=flipr
%uri=https://github.com/sqitchers/sqitch-clickhouse-intro/
</code></pre><p>Note that it contains the name and URI of the app we&rsquo;re building. Sqitch uses
this data to manage cross-project dependencies. The <code>%syntax-version</code> pragma
is always set by Sqitch, so that it always knows how to parse the plan, even
if the format changes in the future.</p>
<p>Let&rsquo;s commit these changes and start creating the database changes.</p>
<pre tabindex="0"><code>&gt; git add .
&gt; git commit -am &#39;Initialize Sqitch configuration.&#39;
[main d32b8ae] Initialize Sqitch configuration.
 2 files changed, 12 insertions(+)
 create mode 100644 sqitch.conf
 create mode 100644 sqitch.plan
</code></pre><h2 id="our-first-change">Our First Change</h2>
<p>Let&rsquo;s create a table. Our app will need users, of course, so we&rsquo;ll create a
table for them. Run this command:</p>
<pre tabindex="0"><code>&gt; sqitch add users -n &#39;Creates table to track our users.&#39;
Created deploy/users.sql
Created revert/users.sql
Created verify/users.sql
Added &#34;users&#34; to sqitch.plan
</code></pre><p>The <a href="/docs/manual/sqitch-add"><code>add</code></a> command adds a database change to the plan and writes
deploy, revert, and verify scripts that represent the change. Now we edit
these files. The <code>deploy</code> script&rsquo;s job is to create the table. By default,
the <code>deploy/users.sql</code> file looks like this:</p>
<pre tabindex="0"><code>-- Deploy flipr:users to clickhouse

-- XXX Add DDLs here.

COMMIT;
</code></pre><p>What we want to do is to replace the <code>XXX</code> comment with the <code>CREATE TABLE</code>
statement, like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Deploy flipr:users to clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> users (
</span></span><span style="display:flex;"><span>    nickname   VARCHAR(<span style="color:#ae81ff">50</span>)  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    password   VARCHAR(<span style="color:#ae81ff">512</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    fullname   VARCHAR(<span style="color:#ae81ff">512</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    mastodon   VARCHAR(<span style="color:#ae81ff">512</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    created_at DATETIME64(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;UTC&#39;</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> now64(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;UTC&#39;</span>)
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#f92672">=</span> MergeTree;
</span></span></code></pre></div><p>The <code>revert</code> script&rsquo;s job is to precisely revert the change to the deploy
script, so we edit this to <code>revert/users.sql</code> to look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Revert flipr:users from clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> users;
</span></span></code></pre></div><p>Now we can try deploying this change. First, we need to create a database
to deploy to. Assuming that ClickHouse is running on localhost using the
<code>default</code> user (as is provided by the
<a href="https://hub.docker.com/_/clickhouse">ClickHouse Docker Image</a>):</p>
<pre tabindex="0"><code>&gt; clickhouse client --query &#39;CREATE DATABASE flipr_test&#39;
</code></pre><p>Now we tell Sqitch where to send the change via a
<a href="https://github.com/libwww-perl/uri-db/">database URI</a>, again assuming the
<code>default</code> user &amp; database and an ODBC driver named <code>ClickHouse</code> (see
<a href="#connection-configuration">&ldquo;Connection Configuration&rdquo;</a> for details):</p>
<pre tabindex="0"><code>&gt; sqitch deploy &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Adding registry tables to db:clickhouse://default@localhost/sqitch?Driver=ClickHouse
Deploying changes to db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
  + users .. ok
</code></pre><p>First Sqitch created the registry database and tables used to track database
changes. The registry database is separate from the database to which the
<code>users</code> change was deployed; by default, its name is <code>sqitch</code>, and will be
used to manage <em>all</em> projects on a single ClickHouse server. Ideally, only
Sqitch data will be stored in this database, so it probably makes the most
sense to create a superuser named <code>sqitch</code> or something similar and use it
to deploy changes.</p>
<p>If you&rsquo;d like it to use a different database as the registry database, use
<code>sqitch engine add clickhouse $name</code> to configure it (or via the
<a href="/docs/manual/sqitch-target"><code>target</code> command</a>; more <a href="#on-target">below</a>). This will be
useful if you don&rsquo;t want to use the same registry database to manage multiple
databases on the same server.</p>
<p>Next, Sqitch deploys changes to the target database, which we specified on the
command-line. We only have one change so far; the <code>+</code> reinforces the idea
that the change is being <em>added</em> to the database.</p>
<p>With this change deployed, if you connect to the database, you&rsquo;ll be able to
see the user:</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;show tables&#39;
users
</code></pre><h3 id="trust-but-verify">Trust, But Verify</h3>
<p>But that&rsquo;s too much work. Do you really want to do something like that after
every deploy?</p>
<p>Here&rsquo;s where the <code>verify</code> script comes in. Its job is to test that the deploy
did was it was supposed to. It should do so without regard to any data that
might be in the database, and should throw an error if the deploy was not
successful. The easiest way to do that with a table is to simply <code>SELECT</code>
from it. Put this query into <code>verify/users.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> nickname, password, fullname, mastodon
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> users
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>Now you can run the <code>verify</code> script with the <a href="/docs/manual/sqitch-verify"><code>verify</code></a>
command:</p>
<pre tabindex="0"><code>&gt; sqitch verify &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Verifying db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
  * users .. ok
Verify successful
</code></pre><p>Looks good! If you want to make sure that the verify script correctly dies if
the table doesn&rsquo;t exist, temporarily change the table name in the script to
something that doesn&rsquo;t exist, something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> nickname, password, fullname, mastodon, created_at
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> users_nonesuch
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>Then <a href="/docs/manual/sqitch-verify"><code>verify</code></a> again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> sqitch verify <span style="color:#e6db74">&#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;</span>
</span></span><span style="display:flex;"><span>Verifying db:clickhouse:<span style="color:#f92672">//</span><span style="color:#66d9ef">default</span><span style="color:#f92672">@</span>localhost<span style="color:#f92672">/</span>flipr_test<span style="color:#f92672">?</span>Driver<span style="color:#f92672">=</span>ClickHouse
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span> users .. Received <span style="color:#66d9ef">exception</span> <span style="color:#66d9ef">from</span> server (<span style="color:#66d9ef">version</span> <span style="color:#ae81ff">25</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>Code: <span style="color:#ae81ff">60</span>. DB::<span style="color:#66d9ef">Exception</span>: Received <span style="color:#66d9ef">from</span> clickhouse:<span style="color:#ae81ff">9000</span>. DB::<span style="color:#66d9ef">Exception</span>: <span style="color:#66d9ef">Unknown</span> <span style="color:#66d9ef">table</span> expression identifier <span style="color:#e6db74">&#39;users_nonesuch&#39;</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">scope</span> <span style="color:#66d9ef">SELECT</span> nickname, password, fullname, mastodon <span style="color:#66d9ef">FROM</span> users_nonesuch <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>. (UNKNOWN_TABLE)
</span></span><span style="display:flex;"><span>(query: <span style="color:#75715e">-- Verify flipr:users on clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> nickname, password, fullname, mastodon
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> users_nonesuch
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;)
</span></span><span style="display:flex;"><span><span style="color:#f92672">#</span> Verify script <span style="color:#e6db74">&#34;verify/users.sql&#34;</span> failed.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">not</span> ok
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Verify Summary Report
</span></span><span style="display:flex;"><span><span style="color:#75715e">---------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Changes: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Errors:  <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Verify failed
</span></span></code></pre></div><p>ClickHouse is kind enough to tell us what the problem is. Don&rsquo;t forget to
change the table name back before continuing!</p>
<h3 id="status-revert-log-repeat">Status, Revert, Log, Repeat</h3>
<p>For purely informational purposes, we can always see how a deployment was
recorded via the <a href="/docs/manual/sqitch-status"><code>status</code></a> command, which reads the registry
tables from the database:</p>
<pre tabindex="0"><code>&gt; sqitch status &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
# On database db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
# Project:  flipr
# Change:   02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
# Name:     users
# Deployed: 2025-09-19 14:32:08 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><p>Let&rsquo;s make sure that we can revert the change:</p>
<pre tabindex="0"><code>&gt; sqitch revert &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Revert all changes from db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse? [Yes]
  - users .. ok
</code></pre><p>The <a href="/docs/manual/sqitch-revert"><code>revert</code></a> command first prompts to make sure that we
really do want to revert. This is to prevent unnecessary accidents. You can
pass the <code>-y</code> option to disable the prompt. Also, notice the <code>-</code> before the
change name in the output, which reinforces that the change is being
<em>removed</em> from the database. And now the schema should be gone:</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;show tables&#39;
</code></pre><p>And the status message should reflect as much:</p>
<pre tabindex="0"><code>&gt; sqitch status &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
# On database db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
No changes deployed
</code></pre><p>Of course, since nothing is deployed, the <a href="/docs/manual/sqitch-verify"><code>verify</code></a> command
has nothing to verify:</p>
<pre tabindex="0"><code>&gt; sqitch verify &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Verifying db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
No changes deployed
</code></pre><p>However, we still have a record that the change happened, visible via the
<a href="/docs/manual/sqitch-log"><code>log</code></a> command:</p>
<pre tabindex="0"><code>&gt; sqitch log &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Revert 02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
Name:      users
Committer: Marge N. O’Vera &lt;marge@example.com&gt;
Date:      2025-09-19 14:33:23 -0400

    Creates table to track our users.

Deploy 02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
Name:      users
Committer: Marge N. O’Vera &lt;marge@example.com&gt;
Date:      2025-09-19 14:32:08 -0400

    Creates table to track our users.
</code></pre><p>Note that the actions we took are shown in reverse chronological order, with
the revert first and then the deploy.</p>
<p>Cool. Now let&rsquo;s commit it.</p>
<pre tabindex="0"><code>&gt; git add .
&gt; git commit -m &#39;Add users table.&#39;
[main 414672a] Add users table.
 4 files changed, 18 insertions(+)
 create mode 100644 deploy/users.sql
 create mode 100644 revert/users.sql
 create mode 100644 verify/users.sql
</code></pre><p>And then deploy again. This time, let&rsquo;s use the <code>--verify</code> option, so that
the <code>verify</code> script is applied when the change is deployed:</p>
<pre tabindex="0"><code>&gt; sqitch deploy --verify &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
Deploying changes to db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
  + users .. ok
</code></pre><p>And now the schema should be back:</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;show tables&#39;
users
</code></pre><p>When we look at the status, the deployment will be there:</p>
<pre tabindex="0"><code>&gt; sqitch status &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
# On database db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse
# Project:  flipr
# Change:   02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
# Name:     users
# Deployed: 2025-09-19 14:34:21 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><h2 id="on-target">On Target</h2>
<p>I&rsquo;m getting a little tired of always having to type
<code>db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse</code>, aren&rsquo;t you?
This <a href="https://github.com/libwww-perl/uri-db/">database connection URI</a> tells
Sqitch how to connect to the deployment target, but we don&rsquo;t have to keep
using the URI. We can name the target:</p>
<pre tabindex="0"><code>&gt; sqitch target add flipr_test &#39;db:clickhouse://default@localhost/flipr_test?Driver=ClickHouse&#39;
</code></pre><p>The <a href="/docs/manual/sqitch-target"><code>target</code></a> command, inspired by
<a href="https://git-scm.com/docs/git-remote"><code>git-remote</code></a>, allows management of one
or more named deployment targets. We&rsquo;ve just added a target named
<code>flipr_test</code>, which means we can use the string <code>flipr_test</code> for the target,
rather than the URI. But since we&rsquo;re doing so much testing, we can also tell
Sqitch to deploy to the <code>flipr_test</code> target by default:</p>
<pre tabindex="0"><code>&gt; sqitch engine add clickhouse flipr_test
</code></pre><p>Now we can omit the target argument altogether, unless we need to deploy to
another database. Which we will, eventually, but at least our examples will be
simpler from here on in, e.g.:</p>
<pre tabindex="0"><code>&gt; sqitch status
# On database flipr_test
# Project:  flipr
# Change:   02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
# Name:     users
# Deployed: 2025-09-19 14:34:21 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><p>Yay, that allows things to be a little more concise. Let&rsquo;s also make sure that
changes are verified after deploying them:</p>
<pre tabindex="0"><code>&gt; sqitch config --bool deploy.verify true
&gt; sqitch config --bool rebase.verify true
</code></pre><p>We&rsquo;ll see the <a href="/docs/manual/sqitch-rebase"><code>rebase</code></a> command a bit later. In the meantime,
let&rsquo;s commit the new configuration and and make some more changes!</p>
<pre tabindex="0"><code>&gt; git commit -am &#39;Set default deployment target and always verify.&#39;
[main ad3a3b0] Set default deployment target and always verify.
 1 file changed, 8 insertions(+)
</code></pre><h2 id="deploy-with-dependency">Deploy with Dependency</h2>
<p>Let&rsquo;s add another change. Our app will need to store status messages from
users. Let&rsquo;s call them &ndash; and the table to store them &ndash; &ldquo;flips&rdquo;. First, add
the new change:</p>
<pre tabindex="0"><code>&gt; sqitch add flips --requires users -n &#39;Adds table for storing flips.&#39;
Created deploy/flips.sql
Created revert/flips.sql
Created verify/flips.sql
Added &#34;flips [users]&#34; to sqitch.plan
</code></pre><p>Note that we&rsquo;re requiring the <code>users</code> change as a dependency of the new
<code>flips</code> change. Although that change has already been added to the plan and
therefore should always be applied before the <code>flips</code> change, it&rsquo;s a good
idea to be explicit about dependencies.</p>
<p>Now edit the scripts. When you&rsquo;re done, <code>deploy/flips.sql</code> should look like
this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Deploy flipr:flips to clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">-- requires: users
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> flips (
</span></span><span style="display:flex;"><span>    id         INTEGER       <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>    nickname   VARCHAR(<span style="color:#ae81ff">50</span>)   <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    body       VARCHAR(<span style="color:#ae81ff">512</span>)  <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    created_at DATETIME64(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;UTC&#39;</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">DEFAULT</span> now64(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#39;UTC&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">CONSTRAINT</span> body_length_check <span style="color:#66d9ef">CHECK</span> ( <span style="color:#66d9ef">char_length</span>(body) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">180</span> ),
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#f92672">=</span> MergeTree;
</span></span></code></pre></div><p>A couple things to notice here. On the second line, the dependence on the
<code>users</code> change has been listed. This doesn&rsquo;t do anything, but the default
<code>deploy</code> template lists it here for your reference while editing the file.
Useful, right?</p>
<p>The <code>users.nickname</code> column implicitly references the <code>users</code> table. This
is why we need to require the <code>users</code> change, even though ClickHouse itself
does not enforce such relationships.</p>
<p>Now for the verify script. Again, all we need to do is <code>SELECT</code> from the
table. I recommend selecting each column by name, too, to be sure that no
column is missing. Here&rsquo;s the <code>verify/flips.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Verify flipr:flips on clickhouse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> id, nickname, body, created_at
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> flips
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>Now for the revert script: all we have to do is drop the table. Add this to
<code>revert/flips.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Revert flipr:flips from firebird
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> flips;
</span></span></code></pre></div><p>Couldn&rsquo;t be much simpler, right? Let&rsquo;s deploy this bad boy:</p>
<pre tabindex="0"><code>&gt; sqitch deploy
Deploying changes to flipr_test
  + flips .. ok
</code></pre><p>We know, since verification is enabled, that the table must have been created.
But for the purposes of visibility, let&rsquo;s have a quick look:</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;show tables&#39;
flips
users
</code></pre><p>We can also verify all currently deployed changes with the
<a href="/docs/manual/sqitch-verify"><code>verify</code></a> command:</p>
<pre tabindex="0"><code>&gt; sqitch verify
Verifying flipr_test
  * users .. ok
  * flips .. ok
Verify successful
</code></pre><p>Now have a look at the status:</p>
<pre tabindex="0"><code>&gt; sqitch status
# On database flipr_test
# Project:  flipr
# Change:   0756d81da8a858a991dca5ffd167fea2de8e98df
# Name:     flips
# Deployed: 2025-09-19 14:36:09 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><p>Success! Let&rsquo;s make sure we can revert the change, as well:</p>
<pre tabindex="0"><code>&gt; sqitch revert --to @HEAD^ -y
Reverting changes to users from flipr_test
  - flips .. ok
</code></pre><p>Note that we&rsquo;ve used the <code>--to</code> option to specify the change to revert to.
And what do we revert to? The symbolic tag <code>@HEAD</code>, when passed to
<a href="/docs/manual/sqitch-revert"><code>revert</code></a>, always refers to the last change deployed to the
database. (For other commands, it refers to the last change in the plan.)
Appending the caret (<code>^</code>) tells Sqitch to select the change <em>prior</em> to the
last deployed change. So we revert to <code>users</code>, the penultimate change. The
other potentially useful symbolic tag is <code>@ROOT</code>, which refers to the first
change deployed to the database (or in the plan, depending on the command).</p>
<p>Back to the database. The <code>flips</code> table should be gone but the
<code>users</code> table should still be around:</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;show tables&#39;
users
</code></pre><p>The <a href="/docs/manual/sqitch-status"><code>status</code></a> command politely informs us that we have
undeployed changes:</p>
<pre tabindex="0"><code>&gt; sqitch status
# On database flipr_test
# Project:  flipr
# Change:   02916d6d5dca9faef8f2bb5822c53de8b7ae16bc
# Name:     users
# Deployed: 2025-09-19 14:34:21 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Undeployed change:
  * flips
</code></pre><p>As does the <a href="/docs/manual/sqitch-verify"><code>verify</code></a> command:</p>
<pre tabindex="0"><code>&gt; sqitch verify
Verifying flipr_test
  * users .. ok
Undeployed change:
  * flips
Verify successful
</code></pre><p>Note that the verify is successful, because all currently-deployed changes are
verified. The list of undeployed changes (just &ldquo;flips&rdquo; here) reminds us about
the current state.</p>
<p>Okay, let&rsquo;s commit and deploy again:</p>
<pre tabindex="0"><code>&gt; git add .
&gt; git commit -am &#39;Add flips table.&#39;
[main 347f867] Add flips table.
 4 files changed, 19 insertions(+)
 create mode 100644 deploy/flips.sql
 create mode 100644 revert/flips.sql
 create mode 100644 verify/flips.sql
&gt; sqitch deploy
Deploying changes to flipr_test
  + flips .. ok
</code></pre><p>Looks good. Check the status:</p>
<pre tabindex="0"><code>&gt; sqitch status
# On database flipr_test
# Project:  flipr
# Change:   0756d81da8a858a991dca5ffd167fea2de8e98df
# Name:     flips
# Deployed: 2025-09-19 14:38:00 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><h2 id="view-to-a-thrill">View to a Thrill</h2>
<p>One more thing to add before we are ready to ship a first beta release. Let&rsquo;s
create a view that lists user names with their flips.</p>
<pre tabindex="0"><code>&gt; sqitch add userflips --requires users --requires flips \
  -n &#39;Creates the userflips view.&#39;
Created deploy/userflips.sql
Created revert/userflips.sql
Created verify/userflips.sql
Added &#34;userflips [users flips]&#34; to sqitch.plan
</code></pre><p>Now add this SQL to <code>deploy/userflips.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">VIEW</span> userflips <span style="color:#66d9ef">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> f.id, u.nickname, u.fullname, f.body, f.created_at <span style="color:#66d9ef">AS</span> created_at
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> users u
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">JOIN</span> flips f <span style="color:#66d9ef">ON</span> u.nickname <span style="color:#f92672">=</span> f.nickname;
</span></span></code></pre></div><p>Add this SQL to <code>verify/userflips.sql</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> id, nickname, fullname, body, created_at
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">FROM</span> userflips
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>And add the <code>DROP VIEW</code> statement to <code>revert/userflips.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">VIEW</span> userflips;
</span></span></code></pre></div><p>Now Try it out!</p>
<pre tabindex="0"><code>&gt; sqitch deploy
Deploying changes to flipr_test
  + userflips .. ok
&gt; sqitch revert -y
Reverting all changes from flipr_test
  - userflips .. ok
  - flips ...... ok
  - users ...... ok
&gt; sqitch deploy
Deploying changes to flipr_test
  + users ...... ok
  + flips ...... ok
  + userflips .. ok
</code></pre><p>Looks good! Commit it.</p>
<pre tabindex="0"><code>&gt; git add .
&gt; git commit -m &#39;Add the userflips view.&#39;
[main f21de26] Add the userflips view.
 4 files changed, 17 insertions(+)
 create mode 100644 deploy/userflips.sql
 create mode 100644 revert/userflips.sql
 create mode 100644 verify/userflips.sql
</code></pre><h2 id="ship-it">Ship It!</h2>
<p>Now we&rsquo;re ready for the first development release of our app. Let&rsquo;s call it
<code>1.0.0-dev1</code> Since we want to have it go out with deployments tied to the
release, let&rsquo;s tag it:</p>
<pre tabindex="0"><code>&gt; sqitch tag v1.0.0-dev1 -n &#39;Tag v1.0.0-dev1.&#39;
Tagged &#34;userflips&#34; with @v1.0.0-dev1
&gt; git commit -am &#39;Tag the database with v1.0.0-dev1.&#39;
[main a821008] Tag the database with v1.0.0-dev1.
 1 files changed, 1 insertions(+), 0 deletions(-)
&gt; git tag v1.0.0-dev1 -am &#39;Tag v1.0.0-dev1&#39;
</code></pre><p>Now let&rsquo;s bundle everything up for release:</p>
<pre tabindex="0"><code>&gt; sqitch bundle
Bundling into bundle
Writing config
Writing plan
Writing scripts
  + users
  + flips
  + userflips @v1.0.0-dev1
</code></pre><p>Now we can package the <code>bundle</code> directory and distribute it. When it gets
installed somewhere, users can use Sqitch to deploy to the database. We ought
to try deploying it, but first we&rsquo;ll need to revert our existing databases, as
a single Sqitch project cannot be deployed to two databases on the same server
unless it uses a different registry database. Fortunately, it&rsquo;s easy to build
the database again, so let&rsquo;s just revert it.</p>
<pre tabindex="0"><code>&gt; sqitch revert -y
Reverting all changes from flipr_test
  - userflips @v1.0.0-dev1 .. ok
  - flips ................... ok
  - users ................... ok
</code></pre><p>Now we can try deploying the bundle:</p>
<pre tabindex="0"><code>&gt; cd bundle
&gt; clickhouse client --query &#39;CREATE DATABASE flipr_dev&#39;
&gt; sqitch deploy &#39;db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse&#39;
Deploying changes to db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok
</code></pre><p>Great, all four changes were deployed and <code>userflips</code> was tagged with
<code>@v1.0.0-dev1</code>. Let&rsquo;s have a look at the status:</p>
<pre tabindex="0"><code>&gt; sqitch status &#39;db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse&#39;
# On database db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse
# Project:  flipr
# Change:   afdfa60d0fd2b7910601648667a23546fe0f7f43
# Name:     userflips
# Tag:      @v1.0.0-dev1
# Deployed: 2025-09-19 14:40:20 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><p>Looks good, eh? Go ahead and revert it:</p>
<pre tabindex="0"><code>&gt; sqitch revert -y &#39;db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse&#39;
Revert all changes from db:clickhouse://default@localhost/flipr_dev?Driver=ClickHouse? [Yes]
  - userflips @v1.0.0-dev1 .. ok
  - flips ................... ok
  - users ................... ok
</code></pre><p>Now package it up and ship it!</p>
<pre tabindex="0"><code>&gt; cd ..
&gt; mv bundle flipr-v1.0.0-dev1
&gt; tar -czf flipr-v1.0.0-dev1.tgz flipr-v1.0.0-dev1
</code></pre><h2 id="making-a-hash-of-things">Making a Hash of Things</h2>
<p>Now that we&rsquo;ve got the basics of the app done, let&rsquo;s add a feature. Gotta
track the hashtags associated with flips, right? Let&rsquo;s add a table for them.
Since other folks are working on other tasks in the repository, we&rsquo;ll work on
a branch, so we can all stay out of each other&rsquo;s way. So let&rsquo;s branch:</p>
<pre tabindex="0"><code>&gt; git checkout -b hashtags
Switched to a new branch &#39;hashtags&#39;
</code></pre><p>Now we can add a new change to create a table for hashtags.</p>
<pre tabindex="0"><code>&gt; sqitch add hashtags --requires flips -n &#39;Adds table for storing hashtags.&#39;
Created deploy/hashtags.sql
Created revert/hashtags.sql
Created verify/hashtags.sql
Added &#34;hashtags [flips]&#34; to sqitch.plan
</code></pre><p>You know the drill by now. Add this to <code>deploy/hashtags.sql</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> hashtags (
</span></span><span style="display:flex;"><span>    flip_id   INTEGER      <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    hashtag   VARCHAR(<span style="color:#ae81ff">512</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">CONSTRAINT</span> hashtag <span style="color:#66d9ef">CHECK</span>(<span style="color:#66d9ef">char_length</span>(hashtag) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>)  ENGINE <span style="color:#f92672">=</span> MergeTree
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (flip_id, hashtag);
</span></span></code></pre></div><p>Again, select from the table in <code>verify/hashtags.sql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> flip_id, hashtag <span style="color:#66d9ef">FROM</span> hashtags <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">false</span>;
</span></span></code></pre></div><p>And drop it in <code>revert/hashtags.sql</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> hashtags;
</span></span></code></pre></div><p>And give it a whirl:</p>
<pre tabindex="0"><code>&gt; sqitch deploy
Deploying changes to flipr_test
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok
  + hashtags ................ ok
</code></pre><p>Look good?</p>
<pre tabindex="0"><code>&gt; sqitch status --show-tags
# On database flipr_test
# Project:  flipr
# Change:   dca0003c3d411c71a672172acab78e4a42dfaa8d
# Name:     hashtags
# Deployed: 2025-09-19 14:48:13 -0400
# By:       Marge N. O’Vera &lt;marge@example.com&gt;
# 
# Tag:
#   @v1.0.0-dev1 - 2025-09-19 14:48:13 -0400 - Marge N. O’Vera &lt;marge@example.com&gt;
# 
Nothing to deploy (up-to-date)
</code></pre><p>Note the use of <code>--show-tags</code> to show all the deployed tags. Now make it so:</p>
<pre tabindex="0"><code>&gt; rm -rf flipr-v1.0.0-dev1*
&gt; git add .
&gt; git commit -am &#39;Add hashtags table.&#39;
[hashtags 1359929] Add hashtags table.
 4 files changed, 17 insertions(+)
 create mode 100644 deploy/hashtags.sql
 create mode 100644 revert/hashtags.sql
 create mode 100644 verify/hashtags.sql
</code></pre><p>Good, we&rsquo;ve finished this feature. Time to merge back into <code>main</code>.</p>
<h3 id="emergency">Emergency</h3>
<p>Let&rsquo;s do it:</p>
<pre tabindex="0"><code>&gt; git checkout main
Switched to branch &#39;main&#39;
&gt; git pull
Updating a821008..b800878
Fast-forward
 deploy/lists.sql | 10 ++++++++++
 revert/lists.sql |  3 +++
 sqitch.plan      |  2 ++
 verify/lists.sql |  5 +++++
 4 files changed, 20 insertions(+)
 create mode 100644 deploy/lists.sql
 create mode 100644 revert/lists.sql
 create mode 100644 verify/lists.sql
</code></pre><p>Hrm, that&rsquo;s interesting. Looks like someone made some changes to <code>main</code>.
They added list support. Well, let&rsquo;s see what happens when we merge our
changes.</p>
<pre tabindex="0"><code>&gt; git merge --no-ff hashtags
Auto-merging sqitch.plan
CONFLICT (content): Merge conflict in sqitch.plan
Automatic merge failed; fix conflicts and then commit the result.
</code></pre><p>Oh, a conflict in <code>sqitch.plan</code>. Not too surprising, since both the merged
<code>lists</code> branch and our <code>hashtags</code> branch added changes to the plan. Let&rsquo;s
try a different approach.</p>
<p>The truth is, we got lazy. Those changes when we pulled main from the origin
should have raised a red flag. It&rsquo;s considered a bad practice not to look at
what&rsquo;s changed in <code>main</code> before merging in a branch. What one <em>should</em> do
is either:</p>
<ul>
<li>Rebase the <code>hashtags</code> branch from main before merging. This &ldquo;rewinds&rdquo; the
branch changes, pulls from <code>main</code>, and then replays the changes back on top
of the pulled changes.</li>
<li>Create a patch and apply <em>that</em> to main. This is the sort of thing you
might have to do if you&rsquo;re sending changes to another user, especially if the
VCS is not Git.</li>
</ul>
<p>So let&rsquo;s restore things to how they were at main:</p>
<pre tabindex="0"><code>&gt; git merge --abort
</code></pre><p>That throws out our botched merge. Now let&rsquo;s go back to our branch and rebase
it on <code>main</code>:</p>
<pre tabindex="0"><code>&gt; git checkout hashtags
Switched to branch &#39;hashtags&#39;
&gt; git rebase main
Auto-merging sqitch.plan
CONFLICT (content): Merge conflict in sqitch.plan
error: could not apply 1359929... Add hashtags table.
hint: Resolve all conflicts manually, mark them as resolved with
hint: &#34;git add/rm &lt;conflicted_files&gt;&#34;, then run &#34;git rebase --continue&#34;.
hint: You can instead skip this commit: run &#34;git rebase --skip&#34;.
hint: To abort and get back to the state before &#34;git rebase&#34;, run &#34;git rebase --abort&#34;.
hint: Disable this message with &#34;git config set advice.mergeConflict false&#34;
Could not apply 1359929... # Add hashtags table.
</code></pre><p>Oy, that&rsquo;s kind of a pain. It seems like no matter what we do, we&rsquo;ll need to
resolve conflicts in that file. Except in Git. Fortunately for us, we can tell
Git to resolve conflicts in <code>sqitch.plan</code> differently. Because we only ever
append lines to the file, we can have it use the &ldquo;union&rdquo; merge driver, which,
according to
<a href="https://git-scm.com/docs/gitattributes#_built-in_merge_drivers">its docs</a>:</p>
<blockquote>
<p>Run 3-way file level merge for text files, but take lines from both versions,
instead of leaving conflict markers. This tends to leave the added lines in
the resulting file in random order and the user should verify the result. Do
not use this if you do not understand the implications.</p></blockquote>
<p>This has the effect of appending lines from all the merging files, which is
exactly what we need. So let&rsquo;s give it a try. First, back out the botched
rebase:</p>
<pre tabindex="0"><code>&gt; git rebase --abort
</code></pre><p>Now add the union merge driver to <code>.gitattributes</code> for <code>sqitch.plan</code>
and rebase again:</p>
<pre tabindex="0"><code>&gt; echo sqitch.plan merge=union &gt; .gitattributes
&gt; git rebase main
Successfully rebased and updated refs/heads/hashtags.
</code></pre><p>Ah, that looks a bit better. Let&rsquo;s have a look at the plan:</p>
<pre tabindex="0"><code>&gt; cat sqitch.plan
%syntax-version=1.0.0
%project=flipr
%uri=https://github.com/sqitchers/sqitch-clickhouse-intro/

users 2025-09-19T18:29:21Z Marge N. O’Vera &lt;marge@example.com&gt; # Creates table to track our users.
flips [users] 2025-09-19T18:35:31Z Marge N. O’Vera &lt;marge@example.com&gt; # Adds table for storing flips.
userflips [users flips] 2025-09-19T18:38:26Z Marge N. O’Vera &lt;marge@example.com&gt; # Creates the userflips view.
@v1.0.0-dev1 2025-09-19T18:39:48Z Marge N. O’Vera &lt;marge@example.com&gt; # Tag v1.0.0-dev1.

lists [flips] 2025-09-19T18:41:17Z An Oth R. Developer &lt;another@example.com&gt; # Adds table for storing lists.
hashtags [flips] 2025-09-19T18:47:02Z Marge N. O’Vera &lt;marge@example.com&gt; # Adds table for storing hashtags.
</code></pre><p>Note that it has appended the changes from the merged &ldquo;lists&rdquo; branch, and then
merged the changes from our &ldquo;hashtags&rdquo; branch. Test it to make sure it works
as expected:</p>
<pre tabindex="0"><code>&gt; sqitch rebase -y
Reverting all changes from flipr_test
  - hashtags ................ ok
  - userflips @v1.0.0-dev1 .. ok
  - flips ................... ok
  - users ................... ok
Deploying changes to flipr_test
  + users ................... ok
  + flips ................... ok
  + userflips @v1.0.0-dev1 .. ok
  + lists ................... ok
  + hashtags ................ ok
</code></pre><p>Note the use of <a href="/docs/manual/sqitch-rebase"><code>rebase</code></a>, which combines a
<a href="/docs/manual/sqitch-revert"><code>revert</code></a> and a <a href="/docs/manual/sqitch-deploy"><code>deploy</code></a> into a single
command. Handy, right? It correctly reverted our changes, and then deployed
them all again in the proper order. So let&rsquo;s commit <code>.gitattributes</code>; seems
worthwhile to keep that change:</p>
<pre tabindex="0"><code>&gt; git add .
&gt; git commit -m &#39;Add `.gitattributes` with union merge for `sqitch.plan`.&#39;
[hashtags 862ea7a] Add `.gitattributes` with union merge for `sqitch.plan`.
 1 file changed, 1 insertion(+)
 create mode 100644 .gitattributes
</code></pre><h3 id="merges-mastered">Merges Mastered</h3>
<p>And now, finally, we can merge into <code>main</code>:</p>
<pre tabindex="0"><code>&gt; git checkout main
Switched to branch &#39;main&#39;
&gt; git merge --no-ff hashtags -m &#34;Merge branch &#39;hashtags&#39;&#34;
Merge made by the &#39;ort&#39; strategy.
 .gitattributes      | 1 +
 deploy/hashtags.sql | 9 +++++++++
 revert/hashtags.sql | 3 +++
 sqitch.plan         | 1 +
 verify/hashtags.sql | 3 +++
 5 files changed, 17 insertions(+)
 create mode 100644 .gitattributes
 create mode 100644 deploy/hashtags.sql
 create mode 100644 revert/hashtags.sql
 create mode 100644 verify/hashtags.sql
</code></pre><p>And double-check our work:</p>
<pre tabindex="0"><code>&gt; cat sqitch.plan
%syntax-version=1.0.0
%project=flipr
%uri=https://github.com/sqitchers/sqitch-clickhouse-intro/

users 2025-09-19T18:29:21Z Marge N. O’Vera &lt;marge@example.com&gt; # Creates table to track our users.
flips [users] 2025-09-19T18:35:31Z Marge N. O’Vera &lt;marge@example.com&gt; # Adds table for storing flips.
userflips [users flips] 2025-09-19T18:38:26Z Marge N. O’Vera &lt;marge@example.com&gt; # Creates the userflips view.
@v1.0.0-dev1 2025-09-19T18:39:48Z Marge N. O’Vera &lt;marge@example.com&gt; # Tag v1.0.0-dev1.

lists [flips] 2025-09-19T18:41:17Z An Oth R. Developer &lt;another@example.com&gt; # Adds table for storing lists.
hashtags [flips] 2025-09-19T18:47:02Z Marge N. O’Vera &lt;marge@example.com&gt; # Adds table for storing hashtags.
</code></pre><p>Much much better, a nice clean main now. And because it is now identical to
the &ldquo;hashtags&rdquo; branch, we can just carry on. Go ahead and tag it, bundle, and
release:</p>
<pre tabindex="0"><code>&gt; sqitch tag v1.0.0-dev2 -n &#39;Tag v1.0.0-dev2.&#39;
Tagged &#34;hashtags&#34; with @v1.0.0-dev2
&gt; git commit -am &#39;Tag the database with v1.0.0-dev2.&#39;
[main 5b56772] Tag the database with v1.0.0-dev2.
 1 file changed, 1 insertion(+)
&gt; git tag v1.0.0-dev2 -am &#39;Tag v1.0.0-dev2&#39;
&gt; sqitch bundle --dest-dir flipr-1.0.0-dev2
Bundling into flipr-1.0.0-dev2
Writing config
Writing plan
Writing scripts
  + users
  + flips
  + userflips @v1.0.0-dev1
  + lists
  + hashtags @v1.0.0-dev2
</code></pre><p>Note the use of the <code>--dest-dir</code> option to <code>sqitch bundle</code>. Just a nicer way
to create the top-level directory name so we don&rsquo;t have to rename it from
<code>bundle</code>.</p>
<h2 id="in-place-changes">In Place Changes</h2>
<p>Well, some folks have been testing the <code>1.0.0-dev2</code> release and have demanded
that Mastodon user links be added to Flipr pages. Why anyone would want to
include social network links in an anti-social networking app is beyond us
programmers, but we&rsquo;re just the plumbers, right? Gotta go with what Marketing
demands. The upshot is that we need to update the <code>userflips</code> view, which is
used for the feature in question, to include the Mastodon user names.</p>
<p>Normally, modifying views in database changes is a
<a href="https://www.urbandictionary.com/define.php?term=pita">PITA</a>. You have to make
changes like these:</p>
<ol>
<li>Copy <code>deploy/userflips.sql</code> to <code>deploy/userflips_mastodon.sql</code>.</li>
<li>Edit <code>deploy/userflips_mastodon.sql</code> to re-create the view with the
new <code>mastodon</code> column added to the view.</li>
<li>Copy <code>deploy/userflips.sql</code> to <code>revert/userflips_mastodon.sql</code>.
Yes, copy the original change script to the new revert change.</li>
<li>Add a <code>DROP VIEW</code> statement to <code>revert/userflips_mastodon.sql</code>.</li>
<li>Copy <code>verify/userflips.sql</code> to <code>verify/userflips_mastodon.sql</code>.</li>
<li>Modify <code>verify/userflips_mastodon.sql</code> to include a check for the <code>mastodon</code>
column.</li>
<li>Test the changes to make sure you can deploy and revert the
<code>userflips_mastodon</code> change.</li>
</ol>
<p>But you can have Sqitch do most of the work for you. The only requirement is
that a tag appear between the two instances of a change we want to modify. In
general, you&rsquo;re going to make a change like this after a release, which you&rsquo;ve
tagged anyway, right? Well we have, with <code>@v1.0.0-dev2</code> added in the previous
section. With that, we can let Sqitch do most of the hard work for us, thanks
to the <a href="/docs/manual/sqitch-rework"><code>rework</code></a> command, which is similar to
<a href="/docs/manual/sqitch-add"><code>add</code></a>:</p>
<pre tabindex="0"><code>&gt; git checkout -b mastodon
&gt; sqitch rework userflips -n &#39;Adds userflips.mastodon.&#39;
Added &#34;userflips [userflips@v1.0.0-dev2]&#34; to sqitch.plan.
Modify these files as appropriate:
  * deploy/userflips.sql
  * revert/userflips.sql
  * verify/userflips.sql
</code></pre><p>Oh, so we can edit those files in place. Nice! How does Sqitch do it? Well, in
point of fact, it has copied the files to stand in for the previous instance
of the <code>userflips</code> change, which we can see via <code>git status</code>:</p>
<pre tabindex="0"><code>&gt; git status
On branch mastodon
Changes not staged for commit:
  (use &#34;git add &lt;file&gt;...&#34; to update what will be committed)
  (use &#34;git restore &lt;file&gt;...&#34; to discard changes in working directory)
        modified:   revert/userflips.sql
        modified:   sqitch.plan

Untracked files:
  (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)
        deploy/userflips@v1.0.0-dev2.sql
        flipr-1.0.0-dev2/
        revert/userflips@v1.0.0-dev2.sql
        verify/userflips@v1.0.0-dev2.sql

no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)
</code></pre><p>The &ldquo;untracked files&rdquo; part of the output is the first thing to notice. They
are all named <code>userflips@v1.0.0-dev2.sql</code>. What that means is: &ldquo;the
<code>userflips</code> change as it was implemented as of the <code>@v1.0.0-dev2</code> tag.&rdquo;
These are copies of the original scripts, and thereafter Sqitch will find them
when it needs to run scripts for the first instance of the <code>userflips</code>
change. As such, it&rsquo;s important not to change them again. But hey, if you&rsquo;re
reworking the change, you shouldn&rsquo;t need to.</p>
<p>The other thing to notice is that <code>revert/userflips.sql</code> has changed. Sqitch
replaced it with the original deploy script. As of now,
<code>deploy/userflips.sql</code> and <code>revert/userflips.sql</code> are identical. This is on
the assumption that the deploy script will be changed (we&rsquo;re reworking it,
remember?), and that the revert script should actually change things back to
how they were before.</p>
<p>Fortunately, our view deploy scripts are already almost
<a href="https://en.wikipedia.org/wiki/Idempotence">idempotent</a> &ndash; that is, able to be
applied multiple times without changing the result beyond the initial
application. If it&rsquo;s not, you will likely need to modify it so that it
properly restores things to how they were after the original deploy script was
deployed. Or, more simply, it should revert changes back to how they were
as-of the deployment of <code>deploy/userflips@v1.0.0-dev2.sql</code>.</p>
<p>Fortunately, our view deploy scripts are already idempotent, thanks to the
use of the <code>OR REPLACE</code> expression. No matter how many times a deployment
script is run, the end result will be the same instance of the view, with
no duplicates or errors.</p>
<p>As a result, there is no need to explicitly add changes. So go ahead. Modify
<code>deploy/userflips.sql</code> to add the <code>mastodon</code> column.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">--- a/deploy/userflips.sql
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ b/deploy/userflips.sql
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -3,6 +3,6 @@
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> -- requires: flips
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> CREATE OR REPLACE VIEW userflips AS
</span></span><span style="display:flex;"><span><span style="color:#f92672">-SELECT f.id, u.nickname, u.fullname, f.body, f.created_at AS created_at
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+SELECT f.id, u.nickname, u.fullname, u.mastodon, f.body, f.created_at created_at
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>   FROM users u
</span></span><span style="display:flex;"><span>   JOIN flips f ON u.nickname = f.nickname;
</span></span></code></pre></div><p>Next, modify <code>verify/userflips.sql</code> to check for the <code>mastodon</code> column.
Here&rsquo;s the diff:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span><span style="color:#f92672">--- a/verify/userflips.sql
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ b/verify/userflips.sql
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -1,5 +1,5 @@
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> -- Verify flipr:userflips on clickhouse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-SELECT id, nickname, fullname, body, created_at
</span></span></span><span style="display:flex;"><span><span style="color:#f92672"></span><span style="color:#a6e22e">+SELECT id, nickname, mastodon, fullname, body, created_at
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>   FROM userflips
</span></span><span style="display:flex;"><span>  WHERE false;
</span></span></code></pre></div><p>Now try a deployment:</p>
<pre tabindex="0"><code>&gt; sqitch deploy
Deploying changes to flipr_test
  + userflips .. ok
</code></pre><p>So, are the changes deployed?</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;describe userflips&#39;
id      Int32
nickname        String
fullname        String
mastodon        String
body    String
created_at      DateTime64(6, \&#39;UTC\&#39;)
</code></pre><p>Awesome, the view now includes the <code>mastodon</code> column. But can we revert?</p>
<pre tabindex="0"><code>&gt; sqitch revert --to @HEAD^ -y
Reverting changes to hashtags @v1.0.0-dev2 from flipr_test
  - userflips .. ok
</code></pre><p>Did that work, is the <code>mastodon</code> column gone?</p>
<pre tabindex="0"><code>&gt; clickhouse client -d flipr_test -q &#39;describe userflips&#39;
id      Int32
nickname        String
fullname        String
body    String
created_at      DateTime64(6, \&#39;UTC\&#39;)
</code></pre><p>Yes, it works! Sqitch properly finds the original instances of these changes
in the new script files that include tags.</p>
<p>Excellent. Let&rsquo;s go ahead and commit these changes and merge them into main:</p>
<pre tabindex="0"><code>&gt; rm -rf flipr-1.0.0-dev2
&gt; git add .
&gt; git commit -m &#39;Add the mastodon column to the userflips view.&#39;
[mastodon 571662b] Add the mastodon column to the userflips view.
 7 files changed, 26 insertions(+), 4 deletions(-)
 create mode 100644 deploy/userflips@v1.0.0-dev2.sql
 create mode 100644 revert/userflips@v1.0.0-dev2.sql
 create mode 100644 verify/userflips@v1.0.0-dev2.sql
&gt; git checkout main
&gt; git merge --no-ff mastodon -m &#34;Merge branch &#39;mastodon&#39;&#34;
Merge made by the &#39;ort&#39; strategy.
 deploy/userflips.sql             | 2 +-
 deploy/userflips@v1.0.0-dev2.sql | 8 ++++++++
 revert/userflips.sql             | 9 +++++++--
 revert/userflips@v1.0.0-dev2.sql | 3 +++
 sqitch.plan                      | 1 +
 verify/userflips.sql             | 2 +-
 verify/userflips@v1.0.0-dev2.sql | 5 +++++
 7 files changed, 26 insertions(+), 4 deletions(-)
 create mode 100644 deploy/userflips@v1.0.0-dev2.sql
 create mode 100644 revert/userflips@v1.0.0-dev2.sql
 create mode 100644 verify/userflips@v1.0.0-dev2.sql
</code></pre><h2 id="more-to-come">More to Come</h2>
<p>Sqitch is a work in progress. Better integration with version control systems
is planned to make managing idempotent reworkings even easier. Stay tuned.</p>
<h2 id="author">Author</h2>
<ul>
<li>David E. Wheeler <a href="mailto:david@justatheory.com">david@justatheory.com</a></li>
</ul>
<h2 id="license">License</h2>
<p>Copyright (c) 2012-2025 David E. Wheeler, 2012-2021 iovation Inc.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &ldquo;Software&rdquo;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

	</main>
	    <footer>
        <div class="code">
            <a href="/site/">About this Site</a><br />
            Corrections, suggestions, and comments <a href="https://github.com/sqitchers/sqitch.org">welcome</a>.
        </div>
    </footer>
</body>
</html>

